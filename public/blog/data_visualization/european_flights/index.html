<!DOCTYPE html>
<html lang="en" dir="ltr"><head>
  
                           
     


<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.79.1" />
<title>European flights | Data Science Blog</title>


<meta property="twitter:site" content="@fgazzelloni">
<meta property="twitter:creator" content="@fgazzelloni">







  
    
  
<meta name="description" content="TidyTuesday 2022 Week 28">


<meta property="og:site_name" content="Data Science Blog">
<meta property="og:title" content="European flights | Data Science Blog">
<meta property="og:description" content="TidyTuesday 2022 Week 28" />
<meta property="og:type" content="page" />
<meta property="og:url" content="https://federicagazzelloni.netlify.app/blog/data_visualization/european_flights/" />
<meta property="og:locale" content="en">




    
        <meta property="og:image" content="https://federicagazzelloni.netlify.app/blog/data_visualization/european_flights/featured.png" >
        <meta property="twitter:card" content="summary_large_image">
        <meta name="twitter:image" content="https://federicagazzelloni.netlify.app/blog/data_visualization/european_flights/featured.png" >
    
    
  <meta itemprop="name" content="European flights">
<meta itemprop="description" content="Overview test     This #TidyTuesday week 28 is all about European flights. I was looking for a visualization that would represent the differences among countries in terms of the number of airports versus number of flights. I looked on the internet for getting some inspiration and then landed on Pintarest, where I found exactly what I was hoping for: a Sankey! First of all, What is a Sankey?">
<meta itemprop="datePublished" content="2022-07-12T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-07-12T00:00:00+00:00" />
<meta itemprop="wordCount" content="1336">
<meta itemprop="image" content="https://federicagazzelloni.netlify.app/blog/data_visualization/european_flights/featured.png">



<meta itemprop="keywords" content="" />

  
  
  <!--[if IE]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/img/favicon.ico" type="image/x-icon">
  
  
  <link rel="stylesheet" href="/style.main.min.b9039fe8b2640ff0b042d1429495fee9c0ad39b715c0a293fb450450524531df.css" integrity="sha256-uQOf6LJkD/CwQtFClJX&#43;6cCtObcVwKKT&#43;0UEUFJFMd8=" media="screen">
  
  
  <script src="/panelset.min.41f62c42d5f25dd80e81136866f4f1baa1bc17669edfd002e75c0e107953789b.js" type="text/javascript"></script>
  
  
  <script src="/main.min.07ec8e08cbb63db3a2cf7d4a7df6f7be00c715f13b64d8df6a2c48441ba8b14b.js" type="text/javascript"></script>
</head>
<body>
      <div class="grid-container single">
<header class="site-header pt4 pb2 mb4 bb b--transparent ph5 headroom z-max" role="banner">
  <nav class="site-nav db dt-l w-100" role="navigation">
    <a class="site-brand db dtc-l v-mid link no-underline w-100 w-33-l tc tl-l" href="https://federicagazzelloni.netlify.app/" title="Home">
      <img src="/img/blogophonic-mark-dark.png" class="dib db-l h2 w-auto" alt="Data Science Blog">
    </a>
    <div class="site-links db dtc-l v-mid w-100 w-47-l tc tr-l mt3 mt0-l ttu tracked">
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/about/" title="About my blog">About</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 active" href="/blog/" title="Blog">Blog</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/technique/" title="Statistical Techniques">Techniques</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/project/" title="Project Portfolio">Projects</a>
      
      
    </div>
  </nav>
</header>

<main class="page-main pa4" role="main">
  <section class="page-content mw7 center">
    <article class="post-content pa0 ph4-l">
      <header class="post-header">
        <h1 class="f1 lh-solid measure-narrow mb3 fw4">European flights</h1>
        
        <p class="f6 measure lh-copy mv1">By Federica Gazzelloni</p>
        <p class="f7 db mv0 ttu">July 12, 2022</p>

      

      </header>
      <section class="post-body pt5 pb4">
        



<h2 id="overview-test">Overview test
  <a href="#overview-test"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>This #TidyTuesday week 28 is all about <strong>European flights</strong>.
I was looking for a visualization that would represent the differences among countries in terms of the number of airports versus number of flights.
I looked on the internet for getting some inspiration and then landed on Pintarest, where I found exactly what I was hoping for: a Sankey!
First of all, <strong>What is a Sankey?</strong>
The answer is clearer after you make one of your own. In short, it is a network graph connecting diffent groups with a ribbon. A few things that made me think about a lot were the requirenment for the type of data to combine, the consequent label results, and the grouping.</p>
<p>So, let&rsquo;s have a go in making a <strong>Sankey</strong>.</p>
<p>Have a quick look at the data for European flights:</p>
<p>Load the {tidyverse} and the data from: 
<a href="https://github.com/rfordatascience/tidytuesday/tree/master/data/2022/2022-07-12" target="_blank" rel="noopener">#TidyTuesday GitHub repo</a></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">flights <span style="color:#000;font-weight:bold">&lt;-</span> readr<span style="color:#000;font-weight:bold">::</span><span style="color:#900;font-weight:bold">read_csv</span>(<span style="color:#d14">&#34;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-07-12/flights.csv&#34;</span>)
</code></pre></div><p>Jus a little cleaning for this type of data with <code>janitor::clean_names()</code> function, and it&rsquo;s ready to use.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">flights <span style="color:#000;font-weight:bold">&lt;-</span> flights <span style="color:#000;font-weight:bold">%&gt;%</span>
  janitor<span style="color:#000;font-weight:bold">::</span><span style="color:#900;font-weight:bold">clean_names</span>()
</code></pre></div><p>The best way is to select a subgroup among the list of the European countries in the data set, and represent the diversity in aerial traffic.</p>
<p>As an example I choose Ukraine airports, and found that there is only one airoprt for Ukraine in the dataset. But, the interesting thing is that it covers on average almost the same aerial traffic of other European countries such as Italy which is provided with a far larger number of airports, in this dataset.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">flights <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">filter</span>(state_name <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;Ukraine&#34;</span>) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">count</span>(state_name, apt_name)
</code></pre></div><pre><code># A tibble: 1 × 3
  state_name apt_name            n
  &lt;chr&gt;      &lt;chr&gt;           &lt;int&gt;
1 Ukraine    Kiev - Boryspil  2248
</code></pre><p>Compare Italy median of the total number of flights by airports with the only available airport aerial traffic in Ukraine:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">flights <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">filter</span>(state_name <span style="color:#000;font-weight:bold">%in%</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#34;Ukraine&#34;</span>, <span style="color:#d14">&#34;Italy&#34;</span>)) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">count</span>(state_name, pivot_label, flt_tot_1) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">group_by</span>(state_name) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">summarize</span>(total_median <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">median</span>(flt_tot_1))
</code></pre></div><pre><code># A tibble: 2 × 2
  state_name total_median
  &lt;chr&gt;             &lt;dbl&gt;
1 Italy              186 
2 Ukraine            212.
</code></pre><p>The results of this preliminary data exploration arise a question:</p>




<h2 id="does-the-number-of-airports-influence-countries-aerial-traffic">Does the number of airports influence countries' aerial traffic?
  <a href="#does-the-number-of-airports-influence-countries-aerial-traffic"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<hr>




<h3 id="waffle">Waffle
  <a href="#waffle"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Make the first part of the visualization as a series of waffle, one for each selected country to show the diferences in number of airports.</p>
<p>Selected are 6 countries with a varied number of airports and flights, this is done to give the idea of the differences.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">df <span style="color:#000;font-weight:bold">&lt;-</span> flights <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">filter</span>(state_name <span style="color:#000;font-weight:bold">%in%</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#34;Ukraine&#34;</span>, <span style="color:#d14">&#34;Belgium&#34;</span>, <span style="color:#d14">&#34;France&#34;</span>, <span style="color:#d14">&#34;Italy&#34;</span>, <span style="color:#d14">&#34;Spain&#34;</span>, <span style="color:#d14">&#34;United Kingdom&#34;</span>)) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">group_by</span>(state_name) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">count</span>(apt_name, sort <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">T</span>) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">mutate</span>(apt_id <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">seq</span>(<span style="color:#099">1</span>, <span style="color:#900;font-weight:bold">length</span>(state_name), <span style="color:#099">1</span>)) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">summarise</span>(tot <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">max</span>(apt_id)) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">arrange</span>(<span style="color:#000;font-weight:bold">-</span>tot)

df
</code></pre></div><pre><code># A tibble: 6 × 2
  state_name       tot
  &lt;chr&gt;          &lt;dbl&gt;
1 France            63
2 Spain             55
3 United Kingdom    19
4 Italy             14
5 Belgium            5
6 Ukraine            1
</code></pre><p>Load both libraries {waffle} and {ggsankey} to use a feature in the waffle which is provided by the ggsankey package.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#900;font-weight:bold">library</span>(waffle)
<span style="color:#900;font-weight:bold">library</span>(ggsankey)
</code></pre></div><p>The waffles shows the number of airports for the selected countries on a total of 100.
To make the waffle we can safetly use the geom_waffle() layer</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">waffle <span style="color:#000;font-weight:bold">&lt;-</span> df <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">mutate</span>(rr <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">100</span> <span style="color:#000;font-weight:bold">-</span> tot) <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#998;font-style:italic"># this is the remaining part of the 100 set of cubes in the waffle</span>
  <span style="color:#900;font-weight:bold">pivot_longer</span>(cols <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(tot, rr), names_to <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;values_name&#34;</span>, values_to <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;values&#34;</span>) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">arrange</span>(state_name) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">ggplot</span>(<span style="color:#900;font-weight:bold">aes</span>(fill <span style="color:#000;font-weight:bold">=</span> values_name, values <span style="color:#000;font-weight:bold">=</span> values)) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">geom_waffle</span>(
    n_rows <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">10</span>,
    size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.33</span>,
    make_proportional <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">F</span>,
    colour <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;white&#34;</span>,
    flip <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">TRUE</span>,
    show.legend <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">F</span>
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">facet_wrap</span>(<span style="color:#000;font-weight:bold">~</span>state_name, nrow <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">coord_equal</span>() <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">scale_fill_manual</span>(values <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#34;grey60&#34;</span>, <span style="color:#d14">&#34;#8E0152&#34;</span>)) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">theme_sankey</span>(base_size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">16</span>) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">theme_enhance_waffle</span>() <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">theme</span>(
    strip.text <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
    plot.background <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
    panel.background <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>()
  )

waffle
</code></pre></div><p><img src="https://federicagazzelloni.netlify.app/blog/data_visualization/european_flights/index_files/figure-html/unnamed-chunk-7-1.png" width="2400" /></p>




<h4 id="sankey">Sankey
  <a href="#sankey"></a>
</h4>
<p>The purpose of this <strong>sankey</strong> is to show the differences among selected countries on number of airports and number of flights, from 2016 to 2022 for 6 selected countries.</p>
<p>The {ggsankey} package uses an interesting function <code>make_long()</code> which transform provided object into a longer data frame, with vectors named as:</p>
<ul>
<li>x, next_x, node, and next_node</li>
</ul>
<p>ready to be used inside the geom_sankey.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">sankey <span style="color:#000;font-weight:bold">&lt;-</span> df <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">left_join</span>(flights <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">select</span>(state_name, flt_tot_1), by <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;state_name&#34;</span>) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">group_by</span>(state_name, tot) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">summarize</span>(total_med <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">median</span>(flt_tot_1), .groups <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;drop&#34;</span>) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">ungroup</span>() <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">mutate</span>(
    class <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">cut</span>(tot,
      breaks <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">5</span>, <span style="color:#099">50</span>, <span style="color:#099">65</span>)
    ), <span style="color:#998;font-style:italic"># ) %&gt;% pull(tot) %&gt;% summary()</span>
    tot_class <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">cut</span>(total_med,
      breaks <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">0</span>, <span style="color:#099">10</span>, <span style="color:#099">30</span>, <span style="color:#099">65</span>, <span style="color:#099">120</span>, <span style="color:#099">700</span>)
    )
  ) <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#998;font-style:italic"># count(tot_class)</span>
  <span style="color:#900;font-weight:bold">mutate</span>(
    class_id <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">case_when</span>(
      class <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;(0,1]&#34;</span> <span style="color:#000;font-weight:bold">~</span> <span style="color:#d14">&#34;one&#34;</span>,
      class <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;(1,5]&#34;</span> <span style="color:#000;font-weight:bold">~</span> <span style="color:#d14">&#34;up to 5&#34;</span>,
      class <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;(5,50]&#34;</span> <span style="color:#000;font-weight:bold">~</span> <span style="color:#d14">&#34;up to 50&#34;</span>,
      <span style="color:#000;font-weight:bold">TRUE</span> <span style="color:#000;font-weight:bold">~</span> <span style="color:#d14">&#34;up to 65&#34;</span>
    ),
    tot_class_id <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">case_when</span>(
      tot_class <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;(0,10]&#34;</span> <span style="color:#000;font-weight:bold">~</span> <span style="color:#d14">&#34;one&#34;</span>,
      tot_class <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;(10,30]&#34;</span> <span style="color:#000;font-weight:bold">~</span> <span style="color:#d14">&#34;up to 30&#34;</span>,
      tot_class <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;(30,65]&#34;</span> <span style="color:#000;font-weight:bold">~</span> <span style="color:#d14">&#34;up to 65&#34;</span>,
      tot_class <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;(65,120]&#34;</span> <span style="color:#000;font-weight:bold">~</span> <span style="color:#d14">&#34;up to 120&#34;</span>,
      <span style="color:#000;font-weight:bold">TRUE</span> <span style="color:#000;font-weight:bold">~</span> <span style="color:#d14">&#34;up to 700&#34;</span>
    )
  ) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">mutate</span>(state_name <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">ifelse</span>(state_name <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;United Kingdom&#34;</span>, <span style="color:#d14">&#34;UK&#34;</span>, state_name)) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#998;font-style:italic"># function to make the object ready to be used in the geom_sankey</span>
  <span style="color:#900;font-weight:bold">make_long</span>(tot_class_id, class_id, state_name) <span style="color:#000;font-weight:bold">%&gt;%</span>
  <span style="color:#900;font-weight:bold">ggplot</span>(<span style="color:#900;font-weight:bold">aes</span>(
    x <span style="color:#000;font-weight:bold">=</span> x,
    label <span style="color:#000;font-weight:bold">=</span> node,
    next_x <span style="color:#000;font-weight:bold">=</span> next_x,
    node <span style="color:#000;font-weight:bold">=</span> node,
    next_node <span style="color:#000;font-weight:bold">=</span> (next_node),
    fill <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">factor</span>(node)
  )) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">geom_sankey</span>(
    flow.alpha <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.8</span>,
    node.color <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>,
    show.legend <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">FALSE</span>
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">geom_sankey_text</span>(angle <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>, family <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Roboto Condensed&#34;</span>, size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">3</span>) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">scale_fill_manual</span>(values <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">colorRampPalette</span>(RColorBrewer<span style="color:#000;font-weight:bold">::</span><span style="color:#900;font-weight:bold">brewer.pal</span>(<span style="color:#099">11</span>, <span style="color:#d14">&#34;PiYG&#34;</span>))(<span style="color:#099">13</span>)) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">theme_sankey</span>(base_size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">16</span>) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">coord_flip</span>(expand <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">F</span>) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">theme</span>(
    axis.text <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
    axis.title <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
    plot.background <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
    panel.background <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>()
  )

sankey
</code></pre></div><p><img src="https://federicagazzelloni.netlify.app/blog/data_visualization/european_flights/index_files/figure-html/unnamed-chunk-8-1.png" width="2400" /></p>




<h4 id="european-map">European Map
  <a href="#european-map"></a>
</h4>
<p>The map has been saved as map.png and sourced in the main visualization. The code can be found in a separate file named &ldquo;eu_coords.R&rdquo;.</p>
<p><img src="map.png" width="205" /></p>
<hr>
<p>Use {cowplot} for assembling the plots, adding notes, the map and the logo as images.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#900;font-weight:bold">library</span>(cowplot)
</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">combo <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">ggdraw</span>() <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">draw_image</span>(<span style="color:#d14">&#34;map.png&#34;</span>,
    scale <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.5</span>,
    x <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.3</span>, y <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.4</span>
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">draw_plot</span>(waffle,
    scale <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>,
    x <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>, y <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.2</span>
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">draw_plot</span>(sankey,
    scale <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.7</span>,
    width <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1.4</span>,
    height <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.85</span>,
    x <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">-0.2</span>, y <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">-0.093</span>
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">draw_label</span>(<span style="color:#d14">&#34;Countries such as France and Spain have the highest number of airports while this\nseems reasonable, other countries such as Ukraine with just one airport record\namong the countries with the highest total number of flights. Data are released\nwithin a range of 7 years from 2016 to 2022.&#34;</span>,
    x <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.02</span>, y <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.90</span>, size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">9</span>, hjust <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>,
    fontfamily <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Roboto Condensed&#34;</span>
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">draw_label</span>(<span style="color:#d14">&#34;N. of airports&#34;</span>,
    x <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.1</span>, y <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.4</span>,
    fontfamily <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Roboto Condensed&#34;</span>
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">draw_label</span>(<span style="color:#d14">&#34;N. of flights\n(median values)&#34;</span>,
    x <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.1</span>, y <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.16</span>,
    fontfamily <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Roboto Condensed&#34;</span>
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">draw_image</span>(<span style="color:#d14">&#34;eurocontrol_logo.png&#34;</span>,
    scale <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.1</span>,
    x <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">-0.45</span>, y <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">-0.52</span>
  ) <span style="color:#000;font-weight:bold">+</span>
  <span style="color:#900;font-weight:bold">draw_label</span>(<span style="color:#d14">&#34;Eurocontrol aviation intelligence\n(ansperformance.eu)&#34;</span>,
    x <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.22</span>, y <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">-0.02</span>, size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">9</span>, fontfamily <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Roboto Condensed&#34;</span>
  )


combo
</code></pre></div><p><img src="https://federicagazzelloni.netlify.app/blog/data_visualization/european_flights/index_files/figure-html/unnamed-chunk-11-1.png" width="2400" /></p>
<p>Use {ggpubr} for arranging the grid of the main visualization, so it can be annotate with <code>annotate_figure()</code> to making it a bit more standing out with spaces around the plot and top and bottmo annotations already at the right distance/position.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#900;font-weight:bold">library</span>(ggpubr)
</code></pre></div><p><code>ggpubr::annotate_figure()</code> provides a framework for annotating the plot on the four sides top, bottom, left and right. It comes a handy function when you&rsquo;d like to position notes or even rich text at specified positions. To use it, it requires an object from <code>ggpubr::ggarrange()</code>.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">plot <span style="color:#000;font-weight:bold">&lt;-</span> ggpubr<span style="color:#000;font-weight:bold">::</span><span style="color:#900;font-weight:bold">ggarrange</span>(combo)

ggpubr<span style="color:#000;font-weight:bold">::</span><span style="color:#900;font-weight:bold">annotate_figure</span>(plot,
  top <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">text_grob</span>(<span style="color:#d14">&#34;Does the number of airports influence countries&#39; aerial traffic?&#34;</span>,
    color <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#34;#8E0152&#34;</span>), face <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;bold&#34;</span>, family <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Roboto Condensed&#34;</span>,
    size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">18</span>, vjust <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1.4</span>
  ),
  bottom <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">text_grob</span>(<span style="color:#d14">&#34;DataSource:TidyTuesday 2022 week28 European flights\nDataViz: Federica Gazzelloni (@fgazzelloni)&#34;</span>,
    color <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;#8E0152&#34;</span>,
    hjust <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>, x <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>, face <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;italic&#34;</span>, family <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Roboto Condensed&#34;</span>,
    size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">10</span>
  ),
  left <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">text_grob</span>(<span style="color:#d14">&#34;&#34;</span>, color <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#34;#7FBC41&#34;</span>), rot <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">90</span>, size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">10</span>),
  right <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">text_grob</span>(<span style="color:#900;font-weight:bold">bquote</span>(<span style="color:#d14">&#34;&#34;</span>), color <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#34;#DE77AE&#34;</span>), rot <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">90</span>, size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">10</span>),
  fig.lab <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;European flights&#34;</span>, fig.lab.face <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;bold&#34;</span>
)
</code></pre></div><p>Then finally, save it as .png file with <code>ggsave()</code> function. I specified a height a little bit more than the default values provided as I needed more space.</p>
<p>The other arguments, <code>dpi</code> and <code>bg</code> are to set the pixels and the background color.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#900;font-weight:bold">ggsave</span>(<span style="color:#d14">&#34;waffle_sankey.png&#34;</span>,
  dpi <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">320</span>,
  bg <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;grey95&#34;</span>,
  height <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">7.2</span>
)
</code></pre></div>
        
        <details closed class="f6 fw7 input-reset">
  <dl class="f6 lh-copy">
    <dt class="fw7">Posted on:</dt>
    <dd class="fw5 ml0">July 12, 2022</dd>
  </dl>
  <dl class="f6 lh-copy">
    <dt class="fw7">Length:</dt>
    <dd class="fw5 ml0">7 minute read, 1336 words</dd>
  </dl>
  
  
  
  <dl class="f6 lh-copy">
    <dt class="fw7">See Also:</dt>
    
  </dl>
</details>

      </section>
      <footer class="post-footer">
        <div class="post-pagination dt w-100 mt4 mb2">
  
  
  
  
    <a class="next dtc pl2 tr v-top fw6"
    href="https://federicagazzelloni.netlify.app/blog/data_visualization/dubois/">DuBois Challenge 2022 &rarr;</a>
  
</div>

      </footer>
    </article>
    
      
<div class="post-comments pa0 pa4-l mt4">
  
  <script src="https://utteranc.es/client.js"
          repo="Fgazzelloni/my_blog"
          issue-term="pathname"
          theme="boxy-light"
          label="comments :crystal_ball:"
          crossorigin="anonymous"
          async
          type="text/javascript">
  </script>
  
</div>

    
  </section>
</main>
<footer class="site-footer pv4 bt b--transparent ph5" role="contentinfo">
  <nav class="db dt-l w-100">
    <p class="site-copyright f7 db dtc-l v-mid w-100 w-33-l tc tl-l pv2 pv0-l mv0 lh-copy">
      &copy; 2022 RStudio, Anywhere
      <span class="middot-divider"></span>
      Made with <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/hugo-apero/" rel="dct:source">Hugo Apéro</a></span>.
      <br />
      
Based on <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/formspree/blogophonic-hugo" rel="dct:source">Blogophonic</a></span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://formspree.io" property="cc:attributionName" rel="cc:attributionURL">Formspree</a>.
    </p>
    
    <div class="site-social-links db dtc-l v-mid w-100 w-33-l tc pv2 pv0-l mv0">
      <div class="social-icon-links" aria-hidden="true">
  
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://github.com/Fgazzelloni" title="github" target="_blank" rel="noopener">
      <i class="fab fa-github fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://twitter.com/Fgazzelloni" title="twitter" target="_blank" rel="noopener">
      <i class="fab fa-twitter fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.linkedin.com/in/fgazzelloni" title="linkedin-in" target="_blank" rel="noopener">
      <i class="fab fa-linkedin-in fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="/index.xml" title="rss" >
      <i class="fas fa-rss fa-lg fa-fw"></i>
    </a>
  
</div>

    </div>
    
    <div class="site-links f6 db dtc-l v-mid w-100 w-67-l tc tr-l pv2 pv0-l mv0">
      
      <a class="dib pv1 ph2 link" href="/license/" title="License">License</a>
      
      <a class="dib pv1 ph2 link" href="/contact/" title="Contact form">Contact</a>
      
      <a class="dib pv1 ph2 link" href="/contributors/" title="Contributors">Contributors</a>
      
    </div>
  </nav>
  
    <script>

    var i, text, code, codes = document.getElementsByTagName('code');
    for (let i = 0; i < codes.length;) {
      code = codes[i];
      if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
        text = code.textContent;
        if (/^\$[^$]/.test(text) && /[^$]\$$/.test(text)) {
          text = text.replace(/^\$/, '\\(').replace(/\$$/, '\\)');
          code.textContent = text;
        }
        if (/^\\\((.|\s)+\\\)$/.test(text) ||
            /^\\\[(.|\s)+\\\]$/.test(text) ||
            /^\$(.|\s)+\$$/.test(text) ||
            /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
          code.outerHTML = code.innerHTML;  
          continue;
        }
      }
      i++;
    }
</script>

  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>



    
  
  
</footer>

      </div>
    </body>
</html>
